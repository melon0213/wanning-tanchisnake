<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸‡å®ç‰ˆè´ªåƒè›‡ - æè‡´çˆ½æ„Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            touch-action: none;
            overflow: hidden;
            background-color: #020617;
        }
        canvas {
            image-rendering: auto;
            max-width: 100%;
            max-height: 60vh;
            border-radius: 1rem;
            box-shadow: 0 0 50px rgba(16, 185, 129, 0.2);
        }
        .wanning-text {
            text-shadow: 0 0 10px rgba(245, 158, 11, 0.8), 0 0 20px rgba(245, 158, 11, 0.4);
            animation: glow 1.5s infinite alternate;
        }
        @keyframes glow {
            from { text-shadow: 0 0 10px #f59e0b; }
            to { text-shadow: 0 0 25px #fbbf24, 0 0 10px #f59e0b; }
        }
        .skill-btn {
            @apply flex flex-col items-center justify-center p-2 rounded-xl border border-slate-700 bg-slate-800/50 backdrop-blur-sm transition-all active:scale-90;
        }
        .skill-ready {
            @apply border-emerald-500 shadow-[0_0_15px_rgba(16,185,129,0.4)];
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen text-white font-sans p-4">

    <!-- é¡¶æ ï¼šä¸‡å®æ•°å€¼ -->
    <div class="w-full max-w-md flex justify-between items-end mb-4 px-2">
        <div>
            <span class="text-amber-400 text-xs font-bold uppercase tracking-widest block mb-1 wanning-text">ä¿®è¡Œå¢ƒç•Œ</span>
            <div class="bg-slate-800/80 px-4 py-1 rounded-full border border-amber-500/30">
                <span id="rank" class="text-lg font-black italic text-amber-500">ç‚¼æ°”åˆæœŸ</span>
            </div>
        </div>
        <div class="text-right">
            <span class="text-slate-400 text-xs block">æ··æ²Œç§¯åˆ†</span>
            <span id="score" class="text-3xl font-black text-emerald-400">0</span>
        </div>
    </div>

    <!-- æ¸¸æˆç”»å¸ƒ -->
    <div id="gameContainer" class="relative bg-slate-900 rounded-3xl p-1 border-2 border-slate-700">
        <canvas id="gameCanvas"></canvas>
        
        <div id="overlay" class="absolute inset-0 flex flex-col items-center justify-center bg-slate-950/90 backdrop-blur-md rounded-2xl z-10 p-6">
            <h1 class="text-5xl font-black mb-2 text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-emerald-500 italic">ä¸‡å®è´ªåƒè›‡</h1>
            <p id="overlayText" class="text-slate-400 mb-8 text-center leading-relaxed">é“å‹ï¼Œæ£€æµ‹åˆ°ä½ éª¨éª¼æƒŠå¥‡ï¼Œ<br>é€Ÿé€Ÿå…¥å®šä¿®ç‚¼ï¼Œè¯å¾—ç¥é¾™å¤§é“ï¼</p>
            <button id="startBtn" class="group relative bg-emerald-500 hover:bg-emerald-400 text-slate-950 font-black py-4 px-12 rounded-full transition-all transform hover:scale-110 active:scale-95 text-xl overflow-hidden">
                <span class="relative z-10">å¼€å¯è¿›åŒ–</span>
                <div class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform"></div>
            </button>
        </div>
    </div>

    <!-- ä¸‡å®æŠ€èƒ½æ  -->
    <div class="w-full max-w-md mt-6">
        <div class="flex justify-between items-center mb-2 px-1">
            <span class="text-xs font-bold text-slate-500 uppercase">ç¥é€šæŠ€èƒ½</span>
            <span class="text-[10px] text-slate-600">ç‚¹å‡»æˆ–æŒ‰ 1/2/3 é‡Šæ”¾</span>
        </div>
        <div class="grid grid-cols-3 gap-3">
            <button id="skill1" class="skill-btn opacity-50 cursor-not-allowed">
                <span class="text-2xl mb-1">âš¡</span>
                <span class="text-[10px] font-bold">ä¸‡å®é›·é˜µ</span>
                <div id="cd1" class="w-full h-1 bg-slate-700 mt-1 rounded-full overflow-hidden">
                    <div class="h-full bg-emerald-500 w-0"></div>
                </div>
            </button>
            <button id="skill2" class="skill-btn opacity-50 cursor-not-allowed">
                <span class="text-2xl mb-1">ğŸ›¡ï¸</span>
                <span class="text-[10px] font-bold">é‡‘åˆšä¸å</span>
                <div id="cd2" class="w-full h-1 bg-slate-700 mt-1 rounded-full overflow-hidden">
                    <div class="h-full bg-blue-500 w-0"></div>
                </div>
            </button>
            <button id="skill3" class="skill-btn opacity-50 cursor-not-allowed">
                <span class="text-2xl mb-1">ğŸŒ€</span>
                <span class="text-[10px] font-bold">æ—¶ç©ºåœæ»</span>
                <div id="cd3" class="w-full h-1 bg-slate-700 mt-1 rounded-full overflow-hidden">
                    <div class="h-full bg-purple-500 w-0"></div>
                </div>
            </button>
        </div>
    </div>

    <!-- æ§åˆ¶æç¤º -->
    <div class="mt-6 flex gap-4 text-slate-600 text-[10px] font-medium sm:flex hidden">
        <span>[WASD] éæ³•</span>
        <span>[SPACE] çˆ†å‘</span>
        <span>[1-3] é‡Šæ”¾ç¥é€š</span>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const rankElement = document.getElementById('rank');
        const overlay = document.getElementById('overlay');
        const startBtn = document.getElementById('startBtn');
        const gameContainer = document.getElementById('gameContainer');

        const GRID_SIZE = 20;
        let tileCount = 20;
        let score = 0;
        let snake = [{x: 10, y: 10}];
        let foods = [{x: 5, y: 5}];
        let dx = 1, dy = 0;
        let nextDx = 1, nextDy = 0;
        let gameActive = false;
        let speed = 8;
        let lastRenderTime = 0;
        
        // ä¸‡å®ç‰¹æ€§ç³»ç»Ÿ
        let particles = [];
        let shakeAmount = 0;
        let rainbowOffset = 0;
        let activeBuffs = { invulnerable: 0, slow: 0 };
        let skills = [
            { id: 1, name: 'é›·é˜µ', cd: 10, currentCd: 0, active: false },
            { id: 2, name: 'é‡‘èº«', cd: 15, currentCd: 0, active: false },
            { id: 3, name: 'æ—¶æ»', cd: 20, currentCd: 0, active: false }
        ];

        const RANKS = ["ç‚¼æ°”", "ç­‘åŸº", "é‡‘ä¸¹", "å…ƒå©´", "åŒ–ç¥", "åˆä½“", "å¤§ä¹˜", "æ¸¡åŠ«", "ä»™å°Š"];

        function resizeCanvas() {
            const size = Math.min(window.innerWidth - 40, 400);
            canvas.width = size;
            canvas.height = size;
            tileCount = Math.floor(size / GRID_SIZE);
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function createParticles(x, y, color, count = 10) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x * GRID_SIZE + GRID_SIZE/2,
                    y: y * GRID_SIZE + GRID_SIZE/2,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 1.0,
                    color: color
                });
            }
        }

        function triggerShake(amt = 5) {
            shakeAmount = amt;
        }

        function activateSkill(index) {
            const s = skills[index];
            if (s.currentCd > 0 || !gameActive) return;

            s.currentCd = s.cd;
            triggerShake(10);

            if (index === 0) { // é›·é˜µï¼šå…¨å±é£Ÿç‰©
                for(let i=0; i<15; i++) placeFood();
            } else if (index === 1) { // é‡‘èº«
                activeBuffs.invulnerable = 300; // çº¦5ç§’
            } else if (index === 2) { // æ—¶æ»
                activeBuffs.slow = 300;
            }
        }

        function update() {
            dx = nextDx; dy = nextDy;
            const head = { x: snake[0].x + dx, y: snake[0].y + dy };

            // ç©¿å¢™ (ä¸‡å®ç‰ˆé€šå¸¸ä¸è®¾é™)
            if (head.x < 0) head.x = tileCount - 1;
            if (head.x >= tileCount) head.x = 0;
            if (head.y < 0) head.y = tileCount - 1;
            if (head.y >= tileCount) head.y = 0;

            // ç¢°æ’é€»è¾‘
            if (activeBuffs.invulnerable <= 0) {
                for (let i = 0; i < snake.length; i++) {
                    if (head.x === snake[i].x && head.y === snake[i].y) {
                        gameOver();
                        return;
                    }
                }
            }

            snake.unshift(head);

            // æ£€æŸ¥é£Ÿç‰©
            let ate = false;
            for (let i = foods.length - 1; i >= 0; i--) {
                if (head.x === foods[i].x && head.y === foods[i].y) {
                    score += 100; // ä¸‡å®åˆ†æ•°åŠ æˆ
                    createParticles(foods[i].x, foods[i].y, '#fbbf24', 15);
                    triggerShake(3);
                    foods.splice(i, 1);
                    ate = true;
                    
                    // è¿åŠ¨è§¦å‘ï¼šä¸‡å®é›·é˜µæ¦‚ç‡
                    if (Math.random() > 0.8) {
                        for(let j=0; j<3; j++) placeFood();
                    }
                    break;
                }
            }

            if (!ate) {
                snake.pop();
            } else {
                if (foods.length < 1) placeFood();
            }

            // æ›´æ–°çŠ¶æ€
            if (activeBuffs.invulnerable > 0) activeBuffs.invulnerable--;
            if (activeBuffs.slow > 0) activeBuffs.slow--;
            
            skills.forEach((s, i) => {
                if (s.currentCd > 0) {
                    s.currentCd -= 0.05;
                    const btn = document.getElementById(`skill${i+1}`);
                    const bar = document.querySelector(`#cd${i+1} div`);
                    const pct = (s.currentCd / s.cd) * 100;
                    bar.style.width = `${pct}%`;
                    if (s.currentCd <= 0) {
                        btn.classList.add('skill-ready');
                        btn.classList.remove('opacity-50', 'cursor-not-allowed');
                    } else {
                        btn.classList.remove('skill-ready');
                    }
                }
            });

            // å¢ƒç•Œæ›´æ–°
            const rankIdx = Math.min(RANKS.length - 1, Math.floor(score / 1000));
            rankElement.textContent = RANKS[rankIdx] + (score % 1000 > 500 ? 'åæœŸ' : 'åˆæœŸ');
            scoreElement.textContent = score;
        }

        function draw() {
            // å±å¹•æŠ–åŠ¨
            if (shakeAmount > 0) {
                const sx = (Math.random() - 0.5) * shakeAmount;
                const sy = (Math.random() - 0.5) * shakeAmount;
                gameContainer.style.transform = `translate(${sx}px, ${sy}px)`;
                shakeAmount *= 0.9;
            } else {
                gameContainer.style.transform = `none`;
            }

            ctx.fillStyle = '#020617';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ç²’å­ç³»ç»Ÿ
            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => {
                p.x += p.vx; p.y += p.vy;
                p.life -= 0.02;
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life;
                ctx.fillRect(p.x, p.y, 3, 3);
            });
            ctx.globalAlpha = 1.0;

            // ç»˜åˆ¶é£Ÿç‰© (å¸¦å‘¼å¸ç¯æ•ˆæœ)
            const foodGlow = Math.sin(Date.now() / 200) * 5 + 10;
            foods.forEach(f => {
                ctx.shadowBlur = foodGlow;
                ctx.shadowColor = '#fbbf24';
                ctx.fillStyle = '#fbbf24';
                ctx.beginPath();
                ctx.arc(f.x * GRID_SIZE + GRID_SIZE/2, f.y * GRID_SIZE + GRID_SIZE/2, GRID_SIZE/3, 0, Math.PI*2);
                ctx.fill();
            });
            ctx.shadowBlur = 0;

            // ç»˜åˆ¶è›‡
            rainbowOffset += 2;
            snake.forEach((s, i) => {
                const isHead = i === 0;
                
                if (activeBuffs.invulnerable > 0) {
                    ctx.fillStyle = `hsl(${(rainbowOffset + i*10)%360}, 80%, 60%)`;
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = ctx.fillStyle;
                } else {
                    ctx.fillStyle = isHead ? '#10b981' : `rgb(16, ${185 - i*2}, 129)`;
                }

                const size = isHead ? GRID_SIZE - 1 : GRID_SIZE - 3;
                const offset = (GRID_SIZE - size) / 2;
                
                roundRect(ctx, s.x * GRID_SIZE + offset, s.y * GRID_SIZE + offset, size, size, isHead ? 8 : 4, true);
                
                if (isHead) {
                    // éœ¸æ°”é¾™çœ¼
                    ctx.fillStyle = 'white';
                    ctx.fillRect(s.x * GRID_SIZE + 5, s.y * GRID_SIZE + 5, 4, 4);
                    ctx.fillRect(s.x * GRID_SIZE + 12, s.y * GRID_SIZE + 5, 4, 4);
                }
            });
            ctx.shadowBlur = 0;
        }

        function roundRect(ctx, x, y, w, h, r, fill) {
            ctx.beginPath();
            ctx.moveTo(x + r, y);
            ctx.arcTo(x + w, y, x + w, y + h, r);
            ctx.arcTo(x + w, y + h, x, y + h, r);
            ctx.arcTo(x, y + h, x, y, r);
            ctx.arcTo(x, y, x + w, y, r);
            ctx.closePath();
            if (fill) ctx.fill();
        }

        function placeFood() {
            const f = {
                x: Math.floor(Math.random() * tileCount),
                y: Math.floor(Math.random() * tileCount)
            };
            foods.push(f);
        }

        function main(currentTime) {
            if (!gameActive) return;
            window.requestAnimationFrame(main);
            
            let effectiveSpeed = activeBuffs.slow > 0 ? speed * 0.4 : speed;
            const secondsSinceLastRender = (currentTime - lastRenderTime) / 1000;
            if (secondsSinceLastRender < 1 / effectiveSpeed) return;

            lastRenderTime = currentTime;
            update();
            draw();
        }

        function startGame() {
            score = 0;
            snake = [{x: 10, y: 10}];
            foods = [{x: 5, y: 5}];
            dx = 1; dy = 0; nextDx = 1; nextDy = 0;
            gameActive = true;
            overlay.style.display = 'none';
            skills.forEach(s => s.currentCd = 0.1); // åˆå§‹å¾®é‡CDè§¦å‘UIæ›´æ–°
            window.requestAnimationFrame(main);
        }

        function gameOver() {
            gameActive = false;
            triggerShake(20);
            overlay.style.display = 'flex';
            document.getElementById('overlayText').innerHTML = `é“å‹æ¸¡åŠ«å¤±è´¥ï¼<br>æ–©è·åŠŸå¾·: <span class="text-emerald-400 font-bold">${score}</span>`;
            document.getElementById('startBtn').textContent = 'å†å…¥è½®å›';
        }

        // ç›‘å¬
        window.addEventListener('keydown', e => {
            switch(e.key) {
                case 'w': case 'ArrowUp': if(dy!==1){nextDx=0;nextDy=-1;} break;
                case 's': case 'ArrowDown': if(dy!==-1){nextDx=0;nextDy=1;} break;
                case 'a': case 'ArrowLeft': if(dx!==1){nextDx=-1;nextDy=0;} break;
                case 'd': case 'ArrowRight': if(dx!==-1){nextDx=1;nextDy=0;} break;
                case '1': activateSkill(0); break;
                case '2': activateSkill(1); break;
                case '3': activateSkill(2); break;
                case ' ': triggerShake(15); break; // ç©ºé—´éœ‡è¡
            }
        });

        document.getElementById('skill1').onclick = () => activateSkill(0);
        document.getElementById('skill2').onclick = () => activateSkill(1);
        document.getElementById('skill3').onclick = () => activateSkill(2);
        startBtn.onclick = startGame;

        draw(); // åˆå§‹ç»˜åˆ¶
    </script>
</body>
</html>